# 构建系统组装：理论与实践

> [原文链接](https://www.cambridge.org/core/journals/journal-of-functional-programming/article/build-systems-a-la-carte-theory-and-practice/097CE52C750E69BD16B78C318754C7A4)

## Abstract
构建系统让人惊艳但是又不怎么受欢迎。它每天被世界上数以万计的开发者所使用，但是很少作为研究学习的内容。

在这个论文中，我们通过将不同的构建系统放在一起比较，得出了一个系统的且可落地的研究框架，借助于这个框架，可以更好的开发与比较不同的构建系统。

通过剖析现有的构建系统，我们可以重新组合他们的基础部件，以实现一个具有新特性的构建系统。

## 1. Introduction
例如 Make，构建系统这种软件是庞大且复杂的，每天被全球数以万计的软件开发人员所使用。但是构建系统往往是软件生态中被遗忘的部分，往往是达成目标的手段，而不会获得更多的关注在其本身。在 Make 统治了数年之后，现在新的场景和需求已经驱动了大量的软件公司，例如微软 、FaceBook 、和 Google 去开发他们自己的构建系统，并在构建系统领域探索新的方案与设计。这些复杂的构建系统使用了一些精妙/微妙的算法，但是往往将其隐藏在底层，并不需要用户进一步了解。

在这个论文中，我们给出一个用于理解和比较构建系统的通用框架，某种程度上来说，这个框架屏蔽了具体的细节，从更高维度去解释构建系统，但是同时也是可实现的。下面具体指出了，我们做的主要工作：

- 构建系统在很多方面存在差异，例如：静态依赖与动态依赖 、本地与云端 、确定性与非确定性构建系统 、早期截断(early cutoff) 、自跟踪构建 、和不同的构建信息存储类型。在第二节，我们通过选择的四个构建系统来对这些关键特性进行说明。
- 在第三节，我们提出了一些简单但是新颖的抽象概念来概括构建系统，通过这些概念，我们可以更好的评估一个构建系统正确性。
- 在第四节和第五节，我们提出了两个被深深嵌入到构建系统的关键设计选择：任务按照什么顺序执行  、任务是否需要重新构建。上面提到的两个选择是正交关系，这也给了我们对构建系统设计空间提供了新的分类标准，这将在第六节进一步说明。
- 基于两个设计的关键选择，我们通过对实际的构建系统：Make 、SHAKE 、BAZEL、BUCK、NIX、EXCEL 等进行细致描述，进一步证明了我们的抽象概念的正确性。
- 还有，我们可以通过组合不同的设计选择来构建出我们需要的构建系统。例如，我们可以组合 SHAKE 和 BAZEL 的优点去实现一个具有动态依赖和云构建模式的构建系统。第七节将对这种组合方式进行规则描述。

## 2. Background
不管是独立开发者还是大型组织，构建系统都是用来自动化执行一些重复的任务。在本小节，我们通过四个例子来探索构建系统的设计空间：Make，EXCEL，Bazel，SHAKE。我们仔细的选择这四个例子去阐明不同构建系统在不同方面的差异。我们在后续的章节也会针对于更多的构建系统进行讨论。

### 2.1 古老的 MAKE：静态依赖与文件更改时间

MAKE 在四十多年前被开发来用于源码到库以及可执行程序的构建。它使用 makefiles 文件来进行描述任务，通常被描述成构建规则和构建依赖：

```makefile
util.o: util.h util.c
    gcc -c util.c

main.o: util.h main.c
    gcc -c main.c

main.exe: util.o main.o
    gcc util.o main.o -o main.exe
```